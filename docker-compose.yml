services:
  gluetun:
    image: qmcgaw/gluetun
    container_name: gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      - gluetun_data:/tmp/gluetun
    environment:
      - VPN_SERVICE_PROVIDER=protonvpn
      - VPN_TYPE=wireguard
      # Add your ProtonVPN credentials here
      # - WIREGUARD_PRIVATE_KEY=...
      # - SERVER_COUNTRIES=...
    ports:
      - "8080:8080"  # qBittorrent WebUI

  qbittorrent:
    image: linuxserver/qbittorrent
    container_name: qbittorrent
    network_mode: "service:gluetun"
    depends_on:
      - gluetun
    volumes:
      - qbt_config:/config
      - downloads:/downloads
    environment:
      - PUID=1000
      - PGID=1000
      - WEBUI_PORT=8080

  portsync:
    build: .
    # Or use a pre-built image:
    # image: ghcr.io/lasardinetechnologique/gluetun-qbittorrent-portsync
    container_name: portsync
    depends_on:
      - gluetun
      - qbittorrent
    volumes:
      - gluetun_data:/tmp/gluetun:ro
    environment:
      - QBT_HOST=gluetun
      - QBT_PORT=8080
      - QBT_USERNAME=admin
      - QBT_PASSWORD=adminadmin
      - RUN_AT_START=true
      - FILE_WATCH=true
      - LOG_LEVEL=info
      # Optional: also run on schedule
      # - CRON_SCHEDULE=*/5 * * * *

volumes:
  gluetun_data:
  qbt_config:
  downloads:
